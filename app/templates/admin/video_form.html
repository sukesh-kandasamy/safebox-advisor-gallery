{% extends "admin/base.html" %}

{% block title %}{% if video %}Edit Video{% else %}Add Video{% endif %} | Safebox Admin{% endblock %}

{% block content %}
<div class="min-h-screen flex bg-slate-50">
  <aside class="w-64 bg-white border-r border-slate-200 flex flex-col fixed inset-y-0 left-0 z-40 shadow-sm">
        <div class="h-16 flex items-center px-6 border-b border-slate-100">
            <a href="/" class="flex items-center gap-3">
                <img src="https://safebox.life/assets/safebox_logo-BNM1guWD.svg" alt="Safebox" class="h-8">
            </a>
        </div>
        <nav class="flex-1 py-6 px-3 space-y-1">
            <a href="/admin/dashboard"
                class="flex items-center gap-3 px-4 py-3 rounded-xl bg-safebox-600 text-white font-medium shadow-sm">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                Videos
            </a>
            <a href="/admin/settings"
                class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 hover:text-safebox-600 hover:bg-safebox-50 transition-colors">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                Settings
            </a>
        </nav>
        <div class="p-4 border-t border-slate-100">
            <div class="flex items-center gap-3 mb-4">
                <div
                    class="w-10 h-10 bg-safebox-600 rounded-full flex items-center justify-center text-white font-bold">
                    {{ user.name[0] if user and user.name else 'A' }}
                </div>
                <div class="flex-1 min-w-0">
                    <p class="text-sm font-medium text-slate-800 truncate">{{ user.name if user else 'Admin' }}</p>
                    <p class="text-xs text-slate-500 truncate">{{ user.email if user else '' }}</p>
                </div>
            </div>
            <form action="/api/auth/logout" method="POST">
                <button type="submit"
                    class="w-full flex items-center justify-center gap-2 px-4 py-2.5 bg-slate-100 hover:bg-safebox-600 rounded-xl text-sm text-slate-600 hover:text-white font-medium transition-colors">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Sign Out
                </button>
            </form>
        </div>
    </aside>
    <main class="flex-1 ml-64">
        <header
            class="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 sticky top-0 z-30">
            <div class="flex items-center gap-4">
                <a href="/admin/dashboard" class="text-slate-400 hover:text-slate-600 transition-colors">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                </a>
                <h1 class="text-xl font-bold text-slate-900">
                    {% if video %}Edit Video{% else %}Add New Video{% endif %}
                </h1>
            </div>
            <div class="flex items-center gap-4">
                <a href="/" target="_blank"
                    class="text-sm text-slate-500 hover:text-safebox-600 flex items-center gap-2 transition-colors">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                    View Site
                </a>
            </div>
        </header>
        <div class="p-8">
            <div class="max-w-2xl">
                <form action="{% if video %}/admin/videos/{{ video.id }}{% else %}/admin/videos{% endif %}"
                    method="POST" class="space-y-6">
                    {% if video %}
                    <div class="bg-white rounded-2xl border border-slate-100 overflow-hidden shadow-sm">
                        <div class="aspect-w-16 aspect-h-9 bg-slate-900">
                            <img src="https://img.youtube.com/vi/{{ video.youtube_id }}/maxresdefault.jpg"
                                alt="{{ video.title }}" class="w-full h-full object-cover">
                        </div>
                    </div>
                    {% endif %}
                    <div class="bg-white rounded-2xl border border-slate-100 shadow-sm p-6 md:p-8 space-y-6">
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Video Title</label>
                            <input type="text" name="title" required class="input-modern"
                                value="{{ video.title if video else '' }}"
                                placeholder="e.g. How to use Safebox for Family Security">
                            <p class="text-xs text-slate-400 mt-2">Make it catchy and descriptive.</p>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">YouTube URL</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="w-5 h-5 text-slate-400" fill="currentColor" viewBox="0 0 24 24">
                                        <path
                                            d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z" />
                                    </svg>
                                </div>
                                <input type="url" name="video_link" required class="input-modern pl-12"
                                    value="{{ video.video_link if video else '' }}"
                                    placeholder="https://www.youtube.com/watch?v=...">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">Description</label>
                            <textarea name="description" rows="4" class="input-modern resize-y"
                                placeholder="Add context about this video...">{{ video.description if video else '' }}</textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-slate-700 mb-2">
                                Next Video in Sequence
                                <span class="text-slate-400 font-normal ml-1">(Optional)</span>
                            </label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="w-5 h-5 text-slate-400" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M13 9l3 3m0 0l-3 3m3-3H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                                <select name="next_video_id"
                                    class="input-modern pl-12 appearance-none cursor-pointer pr-10">
                                    <option value="">-- No next video (end of sequence) --</option>
                                    {% for v in all_videos %}
                                    {% if not video or v.id != video.id %}
                                    <option value="{{ v.id }}" {% if video and video.next_video_id==v.id %}selected{%
                                        endif %}>
                                        {{ v.title }}
                                    </option>
                                    {% endif %}
                                    {% endfor %}
                                </select>
                                <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                    <svg class="w-4 h-4 text-slate-400" fill="none" viewBox="0 0 24 24"
                                        stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                            </div>
                            <p class="text-xs text-slate-400 mt-2">
                                Link videos together to create a step-by-step learning path for users.
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center justify-end gap-4">
                        <a href="/admin/dashboard" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-primary px-8">
                            {% if video %}
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                            Save Changes
                            {% else %}
                            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 4v16m8-8H4" />
                            </svg>
                            Publish Video
                            {% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
</div>
{% endblock %}