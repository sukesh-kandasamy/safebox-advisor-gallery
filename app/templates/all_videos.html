{% extends "base.html" %}

{% block content %}
<section class="bg-gradient-to-br from-safebox-600 to-safebox-700 text-white py-16">
    <div class="max-w-7xl mx-auto px-4">
        <div class="flex items-center gap-4 mb-6">
            <a href="/" class="text-white/70 hover:text-white flex items-center gap-2 transition-colors">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
                Back to Home
            </a>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold mb-4" style="font-family: 'Manrope', sans-serif;">
            Advisor Video Resources
        </h1>
        <p class="text-lg text-white/80 max-w-2xl">
            Explore our library of video guides designed to help you master the Safebox platform and better serve your
            clients.
        </p>
    </div>
</section>
<section class="max-w-7xl mx-auto px-4 py-16">
    <div class="flex items-center justify-between mb-8">
        <h2 class="text-2xl font-bold text-slate-900">{{ videos|length }} Videos Available</h2>
    </div>

    <div id="video-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {% include "components/video_card_list.html" %}
    </div>

    {% if videos|length >= 6 %}
    <div class="text-center mt-12" id="load-more-container">
        <button id="load-more-btn"
            class="inline-flex items-center gap-2 bg-white text-safebox-600 border border-safebox-200 font-semibold px-8 py-3 rounded-full hover:bg-safebox-50 transition-colors">
            Load More Videos
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
        </button>
    </div>
    {% endif %}

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let offset = 6;
            const loadMoreBtn = document.getElementById('load-more-btn');
            const loadMoreContainer = document.getElementById('load-more-container');
            const videoGrid = document.getElementById('video-grid');

            if (loadMoreBtn) {
                loadMoreBtn.addEventListener('click', async function () {
                    try {
                        loadMoreBtn.disabled = true;
                        loadMoreBtn.classList.add('opacity-75', 'cursor-not-allowed');
                        loadMoreBtn.innerHTML = `
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-safebox-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Loading...
                        `;

                        const response = await fetch(`/videos/partial?skip=${offset}`);
                        if (!response.ok) throw new Error('Network response was not ok');

                        const html = await response.text();

                        if (html.trim()) {
                            videoGrid.insertAdjacentHTML('beforeend', html);
                            offset += 6;

                            // Check if we got fewer items than requested (meaning end of list)
                            // A rough check: count occurences of "href" or similar in response
                            const parser = new DOMParser();
                            const doc = parser.parseFromString(html, 'text/html');
                            const newItems = doc.querySelectorAll('a').length;

                            if (newItems < 6) {
                                loadMoreContainer.style.display = 'none';
                            }
                        } else {
                            loadMoreContainer.style.display = 'none';
                        }
                    } catch (error) {
                        console.error('Error loading videos:', error);
                    } finally {
                        if (loadMoreContainer.style.display !== 'none') {
                            loadMoreBtn.disabled = false;
                            loadMoreBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                            loadMoreBtn.innerHTML = `
                                Load More Videos
                                <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            `;
                        }
                    }
                });
            }
        });
    </script>

    {% if not videos %}
    <div class="text-center py-24 bg-white rounded-3xl shadow-sm border border-slate-100">
        <div class="bg-slate-50 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-10 h-10 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                    d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
            </svg>
        </div>
        <h3 class="text-xl font-bold text-slate-900 mb-2">No videos yet</h3>
        <p class="text-slate-500 max-w-sm mx-auto">
            Check back later for new content.
        </p>
    </div>
    {% endif %}
</section>
{% endblock %}